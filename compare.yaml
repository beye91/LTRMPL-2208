- hosts: iosxr
  gather_facts: no
  tasks:
    - name: Get running config
      cisco.iosxr.iosxr_command:
        commands: show running-config
      register: show_running_config
    - name: Create a directory if it does not exist
      ansible.builtin.file:
        path: /tmp/LTRPML-2208/current_configs/iosxr/
        state: directory
    - name: Copy config
      local_action: 
        copy content="{{ show_running_config.stdout[0] | replace('\\n', '\n') }}" 
        dest=/tmp/LTRPML-2208/current_configs/iosxr/{{ inventory_hostname }}.txt
    - name: Replace Strings
      lineinfile:
        path: /tmp/LTRPML-2208/current_configs/iosxr/{{ inventory_hostname }}.txt
        regexp: '(^!!.*)'
        state: absent
    - name: Replace Strings
      lineinfile:
        path: /tmp/LTRPML-2208/current_configs/iosxr/{{ inventory_hostname }}.txt
        regexp: '(^!.*)'
        state: absent